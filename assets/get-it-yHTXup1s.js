import{p as L}from"./parse-headers-IdL03Es5.js";import"./debug-ogcBPJ-f.js";import{i as B}from"./is-plain-object-xrCwLlgG.js";const X=typeof navigator>"u"?!1:navigator.product==="ReactNative",P={timeout:X?6e4:12e4},G=function(r){const t={...P,...typeof r=="string"?{url:r}:r},{searchParams:a}=new URL(t.url,"http://localhost");if(t.timeout=D(t.timeout),t.query){for(const[i,n]of Object.entries(t.query))if(n!==void 0)if(Array.isArray(n))for(const c of n)a.append(i,c);else a.append(i,n)}const[o]=t.url.split("?"),s=a.toString();return s&&(t.url="".concat(o,"?").concat(s)),t.method=t.body&&!t.method?"POST":(t.method||"GET").toUpperCase(),t};function D(e){if(e===!1||e===0)return!1;if(e.connect||e.socket)return e;const r=Number(e);return isNaN(r)?D(P.timeout):{connect:r,socket:r}}const J=/^https?:\/\//i,F=function(r){if(!J.test(r.url))throw new Error('"'.concat(r.url,'" is not a valid URL'))},K=e=>function(t,a,...o){const s=t==="onError";let i=a;for(let n=0;n<e[t].length;n++){const c=e[t][n];if(i=c(i,...o),s&&!i)break}return i};function V(){const e=Object.create(null);let r=0;function t(o){const s=r++;return e[s]=o,function(){delete e[s]}}function a(o){for(const s in e)e[s](o)}return{publish:a,subscribe:t}}const $=["request","response","progress","error","abort"],A=["processOptions","validateOptions","interceptRequest","finalizeOptions","onRequest","onResponse","onError","onReturn","onHeaders"];function I(e,r){const t=[],a=A.reduce((s,i)=>(s[i]=s[i]||[],s),{processOptions:[G],validateOptions:[F]});function o(s){const i=(h,m,y)=>{let p=h,O=m;if(!p)try{O=c("onResponse",m,y)}catch(N){O=null,p=N}p=p&&c("onError",p,y),p?n.error.publish(p):O&&n.response.publish(O)},n=$.reduce((h,m)=>(h[m]=V(),h),{}),c=K(a),l=c("processOptions",s);c("validateOptions",l);const f={options:l,channels:n,applyMiddleware:c};let b;const q=n.request.subscribe(h=>{b=r(h,(m,y)=>i(m,y,h))});n.abort.subscribe(()=>{q(),b&&b.abort()});const C=c("onReturn",n,f);return C===n&&n.request.publish(f),C}return o.use=function(i){if(!i)throw new Error("Tried to add middleware that resolved to falsey value");if(typeof i=="function")throw new Error("Tried to add middleware that was a function. It probably expects you to pass options to it.");if(i.onReturn&&a.onReturn.length>0)throw new Error("Tried to add new middleware with `onReturn` handler, but another handler has already been registered for this event");return A.forEach(n=>{i[n]&&a[n].push(i[n])}),t.push(i),o},o.clone=()=>I(t,r),e.forEach(o.use),o}var U=(e,r,t)=>{if(!r.has(e))throw TypeError("Cannot "+t)},d=(e,r,t)=>(U(e,r,"read from private field"),t?t.call(e):r.get(e)),T=(e,r,t)=>{if(r.has(e))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(e):r.set(e,t)},g=(e,r,t,a)=>(U(e,r,"write to private field"),a?a.call(e,t):r.set(e,t),t),S,_,E,k,w,x,M;class W{constructor(){this.readyState=0,this.responseType="",T(this,S,void 0),T(this,_,void 0),T(this,E,void 0),T(this,k,{}),T(this,w,void 0),T(this,x,{}),T(this,M,void 0)}open(r,t,a){g(this,S,r),g(this,_,t),g(this,E,""),this.readyState=1,this.onreadystatechange(),g(this,w,void 0)}abort(){d(this,w)&&d(this,w).abort()}getAllResponseHeaders(){return d(this,E)}setRequestHeader(r,t){d(this,k)[r]=t}setInit(r,t=!0){g(this,x,r),g(this,M,t)}send(r){const t=this.responseType!=="arraybuffer",a={...d(this,x),method:d(this,S),headers:d(this,k),body:r};typeof AbortController=="function"&&d(this,M)&&(g(this,w,new AbortController),typeof EventTarget<"u"&&d(this,w).signal instanceof EventTarget&&(a.signal=d(this,w).signal)),typeof document<"u"&&(a.credentials=this.withCredentials?"include":"omit"),fetch(d(this,_),a).then(o=>(o.headers.forEach((s,i)=>{g(this,E,d(this,E)+"".concat(i,": ").concat(s,`\r
`))}),this.status=o.status,this.statusText=o.statusText,this.readyState=3,t?o.text():o.arrayBuffer())).then(o=>{typeof o=="string"?this.responseText=o:this.response=o,this.readyState=4,this.onreadystatechange()}).catch(o=>{var s;if(o.name==="AbortError"){this.onabort();return}(s=this.onerror)==null||s.call(this,o)})}}S=new WeakMap;_=new WeakMap;E=new WeakMap;k=new WeakMap;w=new WeakMap;x=new WeakMap;M=new WeakMap;const j=typeof XMLHttpRequest=="function"?"xhr":"fetch",Q=j==="xhr"?XMLHttpRequest:W,Y=(e,r)=>{var t;const a=e.options,o=e.applyMiddleware("finalizeOptions",a),s={},i=e.applyMiddleware("interceptRequest",void 0,{adapter:j,context:e});if(i){const u=setTimeout(r,0,null,i);return{abort:()=>clearTimeout(u)}}let n=new Q;n instanceof W&&typeof o.fetch=="object"&&n.setInit(o.fetch,(t=o.useAbortSignal)!=null?t:!0);const c=o.headers,l=o.timeout;let f=!1,b=!1,q=!1;if(n.onerror=u=>{p(new Error("Request error while attempting to reach ".concat(o.url).concat(u.lengthComputable?"(".concat(u.loaded," of ").concat(u.total," bytes transferred)"):"")))},n.ontimeout=u=>{p(new Error("Request timeout while attempting to reach ".concat(o.url).concat(u.lengthComputable?"(".concat(u.loaded," of ").concat(u.total," bytes transferred)"):"")))},n.onabort=()=>{y(!0),f=!0},n.onreadystatechange=()=>{m(),!(f||n.readyState!==4)&&n.status!==0&&N()},n.open(o.method,o.url,!0),n.withCredentials=!!o.withCredentials,c&&n.setRequestHeader)for(const u in c)c.hasOwnProperty(u)&&n.setRequestHeader(u,c[u]);return o.rawBody&&(n.responseType="arraybuffer"),e.applyMiddleware("onRequest",{options:o,adapter:j,request:n,context:e}),n.send(o.body||null),l&&(s.connect=setTimeout(()=>h("ETIMEDOUT"),l.connect)),{abort:C};function C(){f=!0,n&&n.abort()}function h(u){q=!0,n.abort();const R=new Error(u==="ESOCKETTIMEDOUT"?"Socket timed out on request to ".concat(o.url):"Connection timed out on request to ".concat(o.url));R.code=u,e.channels.error.publish(R)}function m(){l&&(y(),s.socket=setTimeout(()=>h("ESOCKETTIMEDOUT"),l.socket))}function y(u){(u||f||n.readyState>=2&&s.connect)&&clearTimeout(s.connect),s.socket&&clearTimeout(s.socket)}function p(u){if(b)return;y(!0),b=!0,n=null;const R=u||new Error("Network error while attempting to reach ".concat(o.url));R.isNetworkError=!0,R.request=o,r(R)}function O(){return{body:n.response||(n.responseType===""||n.responseType==="text"?n.responseText:""),url:o.url,method:o.method,headers:L(n.getAllResponseHeaders()),statusCode:n.status,statusMessage:n.statusText}}function N(){if(!(f||b||q)){if(n.status===0){p(new Error("Unknown XHR error"));return}y(),b=!0,r(null,O())}}},le=(e=[],r=Y)=>I(e,r),Z=typeof Buffer>"u"?()=>!1:e=>Buffer.isBuffer(e),ee=["boolean","string","number"];function de(){return{processOptions:e=>{const r=e.body;return!r||!(!(typeof r.pipe=="function")&&!Z(r)&&(ee.indexOf(typeof r)!==-1||Array.isArray(r)||B(r)))?e:Object.assign({},e,{body:JSON.stringify(e.body),headers:Object.assign({},e.headers,{"Content-Type":"application/json"})})}}}function pe(e){return{onResponse:t=>{const a=t.headers["content-type"]||"",o=e&&e.force||a.indexOf("application/json")!==-1;return!t.body||!a||!o?t:Object.assign({},t,{body:r(t.body)})},processOptions:t=>Object.assign({},t,{headers:Object.assign({Accept:"application/json"},t.headers)})};function r(t){try{return JSON.parse(t)}catch(a){throw a.message="Failed to parsed response body as JSON: ".concat(a.message),a}}}let v={};typeof globalThis<"u"?v=globalThis:typeof window<"u"?v=window:typeof global<"u"?v=global:typeof self<"u"&&(v=self);var te=v;function fe(e={}){const r=e.implementation||te.Observable;if(!r)throw new Error("`Observable` is not available in global scope, and no implementation was passed");return{onReturn:(t,a)=>new r(o=>(t.error.subscribe(s=>o.error(s)),t.progress.subscribe(s=>o.next(Object.assign({type:"progress"},s))),t.response.subscribe(s=>{o.next(Object.assign({type:"response"},s)),o.complete()}),t.request.publish(a),()=>t.abort.publish()))}}function he(){return{onRequest:e=>{if(e.adapter!=="xhr")return;const r=e.request,t=e.context;"upload"in r&&"onprogress"in r.upload&&(r.upload.onprogress=a("upload")),"onprogress"in r&&(r.onprogress=a("download"));function a(o){return s=>{const i=s.lengthComputable?s.loaded/s.total*100:-1;t.channels.progress.publish({stage:o,percent:i,total:s.total,loaded:s.loaded,lengthComputable:s.lengthComputable})}}}}}class re{constructor(r){this.__CANCEL__=!0,this.message=r}toString(){return"Cancel".concat(this.message?": ".concat(this.message):"")}}const H=class{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let t=null;this.promise=new Promise(a=>{t=a}),r(a=>{this.reason||(this.reason=new re(a),t(this.reason))})}};H.source=()=>{let e;return{token:new H(t=>{e=t}),cancel:e}};var z=(e,r,t)=>t.method!=="GET"&&t.method!=="HEAD"?!1:e.isNetworkError||!1;const oe=e=>e!==null&&typeof e=="object"&&typeof e.pipe=="function";var ne=e=>{const r=e.maxRetries||5,t=e.retryDelay||se,a=e.shouldRetry;return{onError:(o,s)=>{const i=s.options,n=i.maxRetries||r,c=i.shouldRetry||a,l=i.attemptNumber||0;if(oe(i.body)||!c(o,l,i)||l>=n)return o;const f=Object.assign({},s,{options:Object.assign({},i,{attemptNumber:l+1})});return setTimeout(()=>s.channels.request.publish(f),t(l)),null}}};function se(e){return 100*Math.pow(2,e)+Math.random()*100}const ae=(e={})=>ne({shouldRetry:z,...e});ae.shouldRetry=z;export{pe as a,le as g,de as j,fe as o,he as p,ae as r};
