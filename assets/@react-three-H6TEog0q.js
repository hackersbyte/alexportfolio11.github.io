import{_ as Z}from"./@babel-dGVwEr9R.js";import{r as h}from"./react-3DvgMAs9.js";import{L as Se,a as zt,R as It,U as Wt,B as Bt,M as $t,C as Ht,b as Nt,O as Be,P as $e,S as Ye,c as Ce,N as Ut,A as Gt,W as qt,d as Vt,e as Xt,f as Yt,V as Zt,g as V,h as Kt,i as Jt,T as Qt,D as en,j as tn,k as Ze,l as nn,m as rn,n as ae,o as on,p as sn,q as an}from"./three-V6mLslKo.js";import{u as ln}from"./react-use-measure-jfSyW4Bs.js";import{F as cn,u as un}from"./its-fine-PPgEdl0B.js";import{R as fn,c as se}from"./react-reconciler-3G7aL7XC.js";import{c as dn}from"./react-dom-xkArQCbh.js";import"./maath-s6XMKKMY.js";import{G as He,D as pn,M as xe}from"./three-stdlib-cmc6CEyz.js";import{m as ct}from"./react-merge-refs-hAbx5P3g.js";import{c as mn}from"./zustand-fetzVHN8.js";import{s as vn,p as hn,c as gn}from"./suspend-react-7rE_FwbT.js";var vr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function gr(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}),n}var ut={exports:{}},ft={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(y,S){var E=y.length;y.push(S);e:for(;0<E;){var O=E-1>>>1,R=y[O];if(0<s(R,S))y[O]=S,y[E]=R,E=O;else break e}}function n(y){return y.length===0?null:y[0]}function i(y){if(y.length===0)return null;var S=y[0],E=y.pop();if(E!==S){y[0]=E;e:for(var O=0,R=y.length,k=R>>>1;O<k;){var H=2*(O+1)-1,F=y[H],G=H+1,X=y[G];if(0>s(F,E))G<R&&0>s(X,F)?(y[O]=X,y[G]=E,O=G):(y[O]=F,y[H]=E,O=H);else if(G<R&&0>s(X,E))y[O]=X,y[G]=E,O=G;else break e}}return S}function s(y,S){var E=y.sortIndex-S.sortIndex;return E!==0?E:y.id-S.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var p=Date,v=p.now();e.unstable_now=function(){return p.now()-v}}var a=[],g=[],r=1,o=null,u=3,d=!1,m=!1,P=!1,w=typeof setTimeout=="function"?setTimeout:null,c=typeof clearTimeout=="function"?clearTimeout:null,f=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(y){for(var S=n(g);S!==null;){if(S.callback===null)i(g);else if(S.startTime<=y)i(g),S.sortIndex=S.expirationTime,t(a,S);else break;S=n(g)}}function C(y){if(P=!1,b(y),!m)if(n(a)!==null)m=!0,N(x);else{var S=n(g);S!==null&&B(C,S.startTime-y)}}function x(y,S){m=!1,P&&(P=!1,c(D),D=-1),d=!0;var E=u;try{for(b(S),o=n(a);o!==null&&(!(o.expirationTime>S)||y&&!_());){var O=o.callback;if(typeof O=="function"){o.callback=null,u=o.priorityLevel;var R=O(o.expirationTime<=S);S=e.unstable_now(),typeof R=="function"?o.callback=R:o===n(a)&&i(a),b(S)}else i(a);o=n(a)}if(o!==null)var k=!0;else{var H=n(g);H!==null&&B(C,H.startTime-S),k=!1}return k}finally{o=null,u=E,d=!1}}var M=!1,T=null,D=-1,j=5,L=-1;function _(){return!(e.unstable_now()-L<j)}function A(){if(T!==null){var y=e.unstable_now();L=y;var S=!0;try{S=T(!0,y)}finally{S?$():(M=!1,T=null)}}else M=!1}var $;if(typeof f=="function")$=function(){f(A)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,W=q.port2;q.port1.onmessage=A,$=function(){W.postMessage(null)}}else $=function(){w(A,0)};function N(y){T=y,M||(M=!0,$())}function B(y,S){D=w(function(){y(e.unstable_now())},S)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(y){y.callback=null},e.unstable_continueExecution=function(){m||d||(m=!0,N(x))},e.unstable_forceFrameRate=function(y){0>y||125<y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<y?Math.floor(1e3/y):5},e.unstable_getCurrentPriorityLevel=function(){return u},e.unstable_getFirstCallbackNode=function(){return n(a)},e.unstable_next=function(y){switch(u){case 1:case 2:case 3:var S=3;break;default:S=u}var E=u;u=S;try{return y()}finally{u=E}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(y,S){switch(y){case 1:case 2:case 3:case 4:case 5:break;default:y=3}var E=u;u=y;try{return S()}finally{u=E}},e.unstable_scheduleCallback=function(y,S,E){var O=e.unstable_now();switch(typeof E=="object"&&E!==null?(E=E.delay,E=typeof E=="number"&&0<E?O+E:O):E=O,y){case 1:var R=-1;break;case 2:R=250;break;case 5:R=1073741823;break;case 4:R=1e4;break;default:R=5e3}return R=E+R,y={id:r++,callback:S,priorityLevel:y,startTime:E,expirationTime:R,sortIndex:-1},E>O?(y.sortIndex=E,t(g,y),n(a)===null&&y===n(g)&&(P?(c(D),D=-1):P=!0,B(C,E-O))):(y.sortIndex=R,t(a,y),m||d||(m=!0,N(x))),y},e.unstable_shouldYield=_,e.unstable_wrapCallback=function(y){var S=u;return function(){var E=u;u=S;try{return y.apply(this,arguments)}finally{u=E}}}})(ft);ut.exports=ft;var Ke=ut.exports;const Ne={},yn=e=>void Object.assign(Ne,e);function bn(e,t){function n(r,{args:o=[],attach:u,...d},m){let P=`${r[0].toUpperCase()}${r.slice(1)}`,w;if(r==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const c=d.object;w=oe(c,{type:r,root:m,attach:u,primitive:!0})}else{const c=Ne[P];if(!c)throw new Error(`R3F: ${P} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");w=oe(new c(...o),{type:r,root:m,attach:u,memoizedProps:{args:o}})}return w.__r3f.attach===void 0&&(w instanceof Bt?w.__r3f.attach="geometry":w instanceof $t&&(w.__r3f.attach="material")),P!=="inject"&&je(w,d),w}function i(r,o){let u=!1;if(o){var d,m;(d=o.__r3f)!=null&&d.attach?Oe(r,o,o.__r3f.attach):o.isObject3D&&r.isObject3D&&(r.add(o),u=!0),u||(m=r.__r3f)==null||m.objects.push(o),o.__r3f||oe(o,{}),o.__r3f.parent=r,Ie(o),ie(o)}}function s(r,o,u){let d=!1;if(o){var m,P;if((m=o.__r3f)!=null&&m.attach)Oe(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){o.parent=r,o.dispatchEvent({type:"added"});const w=r.children.filter(f=>f!==o),c=w.indexOf(u);r.children=[...w.slice(0,c),o,...w.slice(c)],d=!0}d||(P=r.__r3f)==null||P.objects.push(o),o.__r3f||oe(o,{}),o.__r3f.parent=r,Ie(o),ie(o)}}function l(r,o,u=!1){r&&[...r].forEach(d=>p(o,d,u))}function p(r,o,u){if(o){var d,m,P;if(o.__r3f&&(o.__r3f.parent=null),(d=r.__r3f)!=null&&d.objects&&(r.__r3f.objects=r.__r3f.objects.filter(C=>C!==o)),(m=o.__r3f)!=null&&m.attach)nt(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){var w;r.remove(o),(w=o.__r3f)!=null&&w.root&&Rn(we(o),o)}const f=(P=o.__r3f)==null?void 0:P.primitive,b=!f&&(u===void 0?o.dispose!==null:u);if(!f){var c;l((c=o.__r3f)==null?void 0:c.objects,o,b),l(o.children,o,b)}if(delete o.__r3f,b&&o.dispose&&o.type!=="Scene"){const C=()=>{try{o.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Ke.unstable_scheduleCallback(Ke.unstable_IdlePriority,C):C()}ie(r)}}function v(r,o,u,d){var m;const P=(m=r.__r3f)==null?void 0:m.parent;if(!P)return;const w=n(o,u,r.__r3f.root);if(r.children){for(const c of r.children)c.__r3f&&i(w,c);r.children=r.children.filter(c=>!c.__r3f)}r.__r3f.objects.forEach(c=>i(w,c)),r.__r3f.objects=[],r.__r3f.autoRemovedBeforeAppend||p(P,r),w.parent&&(w.__r3f.autoRemovedBeforeAppend=!0),i(P,w),w.raycast&&w.__r3f.eventCount&&we(w).getState().internal.interaction.push(w),[d,d.alternate].forEach(c=>{c!==null&&(c.stateNode=w,c.ref&&(typeof c.ref=="function"?c.ref(w):c.ref.current=w))})}const a=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:fn({createInstance:n,removeChild:p,appendChild:i,appendInitialChild:i,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(r,o)=>{if(!o)return;const u=r.getState().scene;u.__r3f&&(u.__r3f.root=r,i(u,o))},removeChildFromContainer:(r,o)=>{o&&p(r.getState().scene,o)},insertInContainerBefore:(r,o,u)=>{if(!o||!u)return;const d=r.getState().scene;d.__r3f&&s(d,o,u)},getRootHostContext:()=>null,getChildHostContext:r=>r,finalizeInitialChildren(r){var o;return!!((o=r==null?void 0:r.__r3f)!=null?o:{}).handlers},prepareUpdate(r,o,u,d){var m;if(((m=r==null?void 0:r.__r3f)!=null?m:{}).primitive&&d.object&&d.object!==r)return[!0];{const{args:w=[],children:c,...f}=d,{args:b=[],children:C,...x}=u;if(!Array.isArray(w))throw new Error("R3F: the args prop must be an array!");if(w.some((T,D)=>T!==b[D]))return[!0];const M=yt(r,f,x,!0);return M.changes.length?[!1,M]:null}},commitUpdate(r,[o,u],d,m,P,w){o?v(r,d,P,w):je(r,u)},commitMount(r,o,u,d){var m;const P=(m=r.__r3f)!=null?m:{};r.raycast&&P.handlers&&P.eventCount&&we(r).getState().internal.interaction.push(r)},getPublicInstance:r=>r,prepareForCommit:()=>null,preparePortalMount:r=>oe(r.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(r){var o;const{attach:u,parent:d}=(o=r.__r3f)!=null?o:{};u&&d&&nt(d,r,u),r.isObject3D&&(r.visible=!1),ie(r)},unhideInstance(r,o){var u;const{attach:d,parent:m}=(u=r.__r3f)!=null?u:{};d&&m&&Oe(m,r,d),(r.isObject3D&&o.visible==null||o.visible)&&(r.visible=!0),ie(r)},createTextInstance:a,hideTextInstance:a,unhideTextInstance:a,getCurrentEventPriority:()=>t?t():se.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&I.fun(performance.now)?performance.now:I.fun(Date.now)?Date.now:()=>0,scheduleTimeout:I.fun(setTimeout)?setTimeout:void 0,cancelTimeout:I.fun(clearTimeout)?clearTimeout:void 0}),applyProps:je}}var Je,Qe;const Re=e=>"colorSpace"in e||"outputColorSpace"in e,dt=()=>{var e;return(e=Ne.ColorManagement)!=null?e:null},pt=e=>e&&e.isOrthographicCamera,wn=e=>e&&e.hasOwnProperty("current"),pe=typeof window<"u"&&((Je=window.document)!=null&&Je.createElement||((Qe=window.navigator)==null?void 0:Qe.product)==="ReactNative")?h.useLayoutEffect:h.useEffect;function mt(e){const t=h.useRef(e);return pe(()=>void(t.current=e),[e]),t}function _n({set:e}){return pe(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class vt extends h.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}vt.getDerivedStateFromError=()=>({error:!0});const ht="__default",et=new Map,Pn=e=>e&&!!e.memoized&&!!e.changes;function gt(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const ue=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function we(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const I={obj:e=>e===Object(e)&&!I.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:i="reference",strict:s=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(I.str(e)||I.num(e))return e===t;const l=I.obj(e);if(l&&i==="reference")return e===t;const p=I.arr(e);if(p&&n==="reference")return e===t;if((p||l)&&e===t)return!0;let v;for(v in e)if(!(v in t))return!1;if(l&&n==="shallow"&&i==="shallow"){for(v in s?t:e)if(!I.equ(e[v],t[v],{strict:s,objects:"reference"}))return!1}else for(v in s?t:e)if(e[v]!==t[v])return!1;if(I.und(v)){if(p&&e.length===0&&t.length===0||l&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function En(e){const t={nodes:{},materials:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material)}),t}function Mn(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function oe(e,t){const n=e;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function ze(e,t){let n=e;if(t.includes("-")){const i=t.split("-"),s=i.pop();return n=i.reduce((l,p)=>l[p],e),{target:n,key:s}}else return{target:n,key:t}}const tt=/-\d+$/;function Oe(e,t,n){if(I.str(n)){if(tt.test(n)){const l=n.replace(tt,""),{target:p,key:v}=ze(e,l);Array.isArray(p[v])||(p[v]=[])}const{target:i,key:s}=ze(e,n);t.__r3f.previousAttach=i[s],i[s]=t}else t.__r3f.previousAttach=n(e,t)}function nt(e,t,n){var i,s;if(I.str(n)){const{target:l,key:p}=ze(e,n),v=t.__r3f.previousAttach;v===void 0?delete l[p]:l[p]=v}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(s=t.__r3f)==null||delete s.previousAttach}function yt(e,{children:t,key:n,ref:i,...s},{children:l,key:p,ref:v,...a}={},g=!1){var r;const o=(r=e==null?void 0:e.__r3f)!=null?r:{},u=Object.entries(s),d=[];if(g){const P=Object.keys(a);for(let w=0;w<P.length;w++)s.hasOwnProperty(P[w])||u.unshift([P[w],ht+"remove"])}u.forEach(([P,w])=>{var c;if((c=e.__r3f)!=null&&c.primitive&&P==="object"||I.equ(w,a[P]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(P))return d.push([P,w,!0,[]]);let f=[];P.includes("-")&&(f=P.split("-")),d.push([P,w,!1,f]);for(const b in s){const C=s[b];b.startsWith(`${P}-`)&&d.push([b,C,!1,b.split("-")])}});const m={...s};return o.memoizedProps&&o.memoizedProps.args&&(m.args=o.memoizedProps.args),o.memoizedProps&&o.memoizedProps.attach&&(m.attach=o.memoizedProps.attach),{memoized:m,changes:d}}const Sn=typeof process<"u"&&!1;function je(e,t){var n,i,s;const l=(n=e.__r3f)!=null?n:{},p=l.root,v=(i=p==null||p.getState==null?void 0:p.getState())!=null?i:{},{memoized:a,changes:g}=Pn(t)?t:yt(e,t),r=l.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let u=0;u<g.length;u++){let[d,m,P,w]=g[u];if(Re(e)){const C="srgb",x="srgb-linear";d==="encoding"?(d="colorSpace",m=m===3001?C:x):d==="outputEncoding"&&(d="outputColorSpace",m=m===3001?C:x)}let c=e,f=c[d];if(w.length&&(f=w.reduce((b,C)=>b[C],e),!(f&&f.set))){const[b,...C]=w.reverse();c=C.reverse().reduce((x,M)=>x[M],e),d=b}if(m===ht+"remove")if(c.constructor){let b=et.get(c.constructor);b||(b=new c.constructor,et.set(c.constructor,b)),m=b[d]}else m=0;if(P)m?l.handlers[d]=m:delete l.handlers[d],l.eventCount=Object.keys(l.handlers).length;else if(f&&f.set&&(f.copy||f instanceof Se)){if(Array.isArray(m))f.fromArray?f.fromArray(m):f.set(...m);else if(f.copy&&m&&m.constructor&&(Sn?f.constructor.name===m.constructor.name:f.constructor===m.constructor))f.copy(m);else if(m!==void 0){const b=f instanceof Ht;!b&&f.setScalar?f.setScalar(m):f instanceof Se&&m instanceof Se?f.mask=m.mask:f.set(m),!dt()&&!v.linear&&b&&f.convertSRGBToLinear()}}else if(c[d]=m,c[d]instanceof zt&&c[d].format===It&&c[d].type===Wt){const b=c[d];Re(b)&&Re(v.gl)?b.colorSpace=v.gl.outputColorSpace:b.encoding=v.gl.outputEncoding}ie(e)}if(l.parent&&e.raycast&&r!==l.eventCount){const u=we(e).getState().internal,d=u.interaction.indexOf(e);d>-1&&u.interaction.splice(d,1),l.eventCount&&u.interaction.push(e)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(s=e.__r3f)!=null&&s.parent&&Ie(e),e}function ie(e){var t,n;const i=(t=e.__r3f)==null||(n=t.root)==null||n.getState==null?void 0:n.getState();i&&i.internal.frames===0&&i.invalidate()}function Ie(e){e.onUpdate==null||e.onUpdate(e)}function Cn(e,t){e.manual||(pt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ge(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function xn(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return se.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return se.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return se.ContinuousEventPriority;default:return se.DefaultEventPriority}}function bt(e,t,n,i){const s=n.get(t);s&&(n.delete(t),n.size===0&&(e.delete(i),s.target.releasePointerCapture(i)))}function Rn(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(i=>i!==t),n.initialHits=n.initialHits.filter(i=>i!==t),n.hovered.forEach((i,s)=>{(i.eventObject===t||i.object===t)&&n.hovered.delete(s)}),n.capturedMap.forEach((i,s)=>{bt(n.capturedMap,t,i,s)})}function On(e){function t(a){const{internal:g}=e.getState(),r=a.offsetX-g.initialClick[0],o=a.offsetY-g.initialClick[1];return Math.round(Math.sqrt(r*r+o*o))}function n(a){return a.filter(g=>["Move","Over","Enter","Out","Leave"].some(r=>{var o;return(o=g.__r3f)==null?void 0:o.handlers["onPointer"+r]}))}function i(a,g){const r=e.getState(),o=new Set,u=[],d=g?g(r.internal.interaction):r.internal.interaction;for(let c=0;c<d.length;c++){const f=ue(d[c]);f&&(f.raycaster.camera=void 0)}r.previousRoot||r.events.compute==null||r.events.compute(a,r);function m(c){const f=ue(c);if(!f||!f.events.enabled||f.raycaster.camera===null)return[];if(f.raycaster.camera===void 0){var b;f.events.compute==null||f.events.compute(a,f,(b=f.previousRoot)==null?void 0:b.getState()),f.raycaster.camera===void 0&&(f.raycaster.camera=null)}return f.raycaster.camera?f.raycaster.intersectObject(c,!0):[]}let P=d.flatMap(m).sort((c,f)=>{const b=ue(c.object),C=ue(f.object);return!b||!C?c.distance-f.distance:C.events.priority-b.events.priority||c.distance-f.distance}).filter(c=>{const f=ge(c);return o.has(f)?!1:(o.add(f),!0)});r.events.filter&&(P=r.events.filter(P,r));for(const c of P){let f=c.object;for(;f;){var w;(w=f.__r3f)!=null&&w.eventCount&&u.push({...c,eventObject:f}),f=f.parent}}if("pointerId"in a&&r.internal.capturedMap.has(a.pointerId))for(let c of r.internal.capturedMap.get(a.pointerId).values())o.has(ge(c.intersection))||u.push(c.intersection);return u}function s(a,g,r,o){const u=e.getState();if(a.length){const d={stopped:!1};for(const m of a){const P=ue(m.object)||u,{raycaster:w,pointer:c,camera:f,internal:b}=P,C=new V(c.x,c.y,0).unproject(f),x=L=>{var _,A;return(_=(A=b.capturedMap.get(L))==null?void 0:A.has(m.eventObject))!=null?_:!1},M=L=>{const _={intersection:m,target:g.target};b.capturedMap.has(L)?b.capturedMap.get(L).set(m.eventObject,_):b.capturedMap.set(L,new Map([[m.eventObject,_]])),g.target.setPointerCapture(L)},T=L=>{const _=b.capturedMap.get(L);_&&bt(b.capturedMap,m.eventObject,_,L)};let D={};for(let L in g){let _=g[L];typeof _!="function"&&(D[L]=_)}let j={...m,...D,pointer:c,intersections:a,stopped:d.stopped,delta:r,unprojectedPoint:C,ray:w.ray,camera:f,stopPropagation(){const L="pointerId"in g&&b.capturedMap.get(g.pointerId);if((!L||L.has(m.eventObject))&&(j.stopped=d.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(_=>_.eventObject===m.eventObject))){const _=a.slice(0,a.indexOf(m));l([..._,m])}},target:{hasPointerCapture:x,setPointerCapture:M,releasePointerCapture:T},currentTarget:{hasPointerCapture:x,setPointerCapture:M,releasePointerCapture:T},nativeEvent:g};if(o(j),d.stopped===!0)break}}return a}function l(a){const{internal:g}=e.getState();for(const r of g.hovered.values())if(!a.length||!a.find(o=>o.object===r.object&&o.index===r.index&&o.instanceId===r.instanceId)){const u=r.eventObject.__r3f,d=u==null?void 0:u.handlers;if(g.hovered.delete(ge(r)),u!=null&&u.eventCount){const m={...r,intersections:a};d.onPointerOut==null||d.onPointerOut(m),d.onPointerLeave==null||d.onPointerLeave(m)}}}function p(a,g){for(let r=0;r<g.length;r++){const o=g[r].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(a)}}function v(a){switch(a){case"onPointerLeave":case"onPointerCancel":return()=>l([]);case"onLostPointerCapture":return g=>{const{internal:r}=e.getState();"pointerId"in g&&r.capturedMap.has(g.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(g.pointerId)&&(r.capturedMap.delete(g.pointerId),l([]))})}}return function(r){const{onPointerMissed:o,internal:u}=e.getState();u.lastEvent.current=r;const d=a==="onPointerMove",m=a==="onClick"||a==="onContextMenu"||a==="onDoubleClick",w=i(r,d?n:void 0),c=m?t(r):0;a==="onPointerDown"&&(u.initialClick=[r.offsetX,r.offsetY],u.initialHits=w.map(b=>b.eventObject)),m&&!w.length&&c<=2&&(p(r,u.interaction),o&&o(r)),d&&l(w);function f(b){const C=b.eventObject,x=C.__r3f,M=x==null?void 0:x.handlers;if(x!=null&&x.eventCount)if(d){if(M.onPointerOver||M.onPointerEnter||M.onPointerOut||M.onPointerLeave){const T=ge(b),D=u.hovered.get(T);D?D.stopped&&b.stopPropagation():(u.hovered.set(T,b),M.onPointerOver==null||M.onPointerOver(b),M.onPointerEnter==null||M.onPointerEnter(b))}M.onPointerMove==null||M.onPointerMove(b)}else{const T=M[a];T?(!m||u.initialHits.includes(C))&&(p(r,u.interaction.filter(D=>!u.initialHits.includes(D))),T(b)):m&&u.initialHits.includes(C)&&p(r,u.interaction.filter(D=>!u.initialHits.includes(D)))}}s(w,r,c,f)}}return{handlePointer:v}}const wt=e=>!!(e!=null&&e.render),_t=h.createContext(null),jn=(e,t)=>{const n=mn((v,a)=>{const g=new V,r=new V,o=new V;function u(c=a().camera,f=r,b=a().size){const{width:C,height:x,top:M,left:T}=b,D=C/x;f instanceof V?o.copy(f):o.set(...f);const j=c.getWorldPosition(g).distanceTo(o);if(pt(c))return{width:C/c.zoom,height:x/c.zoom,top:M,left:T,factor:1,distance:j,aspect:D};{const L=c.fov*Math.PI/180,_=2*Math.tan(L/2)*j,A=_*(C/x);return{width:A,height:_,top:M,left:T,factor:C/A,distance:j,aspect:D}}}let d;const m=c=>v(f=>({performance:{...f.performance,current:c}})),P=new Kt;return{set:v,get:a,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(c=1)=>e(a(),c),advance:(c,f)=>t(c,f,a()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Jt,pointer:P,mouse:P,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const c=a();d&&clearTimeout(d),c.performance.current!==c.performance.min&&m(c.performance.min),d=setTimeout(()=>m(a().performance.max),c.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:u},setEvents:c=>v(f=>({...f,events:{...f.events,...c}})),setSize:(c,f,b,C,x)=>{const M=a().camera,T={width:c,height:f,top:C||0,left:x||0,updateStyle:b};v(D=>({size:T,viewport:{...D.viewport,...u(M,r,T)}}))},setDpr:c=>v(f=>{const b=gt(c);return{viewport:{...f.viewport,dpr:b,initialDpr:f.viewport.initialDpr||b}}}),setFrameloop:(c="always")=>{const f=a().clock;f.stop(),f.elapsedTime=0,c!=="never"&&(f.start(),f.elapsedTime=0),v(()=>({frameloop:c}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:h.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(c,f,b)=>{const C=a().internal;return C.priority=C.priority+(f>0?1:0),C.subscribers.push({ref:c,priority:f,store:b}),C.subscribers=C.subscribers.sort((x,M)=>x.priority-M.priority),()=>{const x=a().internal;x!=null&&x.subscribers&&(x.priority=x.priority-(f>0?1:0),x.subscribers=x.subscribers.filter(M=>M.ref!==c))}}}}}),i=n.getState();let s=i.size,l=i.viewport.dpr,p=i.camera;return n.subscribe(()=>{const{camera:v,size:a,viewport:g,gl:r,set:o}=n.getState();if(a.width!==s.width||a.height!==s.height||g.dpr!==l){var u;s=a,l=g.dpr,Cn(v,a),r.setPixelRatio(g.dpr);const d=(u=a.updateStyle)!=null?u:typeof HTMLCanvasElement<"u"&&r.domElement instanceof HTMLCanvasElement;r.setSize(a.width,a.height,d)}v!==p&&(p=v,o(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(v)}})))}),n.subscribe(v=>e(v)),n};function kn(e,t){const n={callback:e};return t.add(n),()=>void t.delete(n)}let ye,Pt=new Set,Tn=new Set,An=new Set;const yr=e=>kn(e,Pt);function ke(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function fe(e,t){switch(e){case"before":return ke(Pt,t);case"after":return ke(Tn,t);case"tail":return ke(An,t)}}let Te,Ae;function De(e,t,n){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Te=t.internal.subscribers,ye=0;ye<Te.length;ye++)Ae=Te[ye],Ae.ref.current(Ae.store.getState(),i,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Dn(e){let t=!1,n,i,s;function l(a){i=requestAnimationFrame(l),t=!0,n=0,fe("before",a);for(const r of e.values()){var g;s=r.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((g=s.gl.xr)!=null&&g.isPresenting)&&(n+=De(a,s))}if(fe("after",a),n===0)return fe("tail",a),t=!1,cancelAnimationFrame(i)}function p(a,g=1){var r;if(!a)return e.forEach(o=>p(o.store.getState()),g);(r=a.gl.xr)!=null&&r.isPresenting||!a.internal.active||a.frameloop==="never"||(a.internal.frames=Math.min(60,a.internal.frames+g),t||(t=!0,requestAnimationFrame(l)))}function v(a,g=!0,r,o){if(g&&fe("before",a),r)De(a,r,o);else for(const u of e.values())De(a,u.store.getState());g&&fe("after",a)}return{loop:l,invalidate:p,advance:v}}function Et(){const e=h.useContext(_t);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function _e(e=n=>n,t){return Et()(e,t)}function Ee(e,t=0){const n=Et(),i=n.getState().internal.subscribe,s=mt(e);return pe(()=>i(s,t,n),[t,i,n]),null}const rt=new WeakMap;function Mt(e,t){return function(n,...i){let s=rt.get(n);return s||(s=new n,rt.set(n,s)),e&&e(s),Promise.all(i.map(l=>new Promise((p,v)=>s.load(l,a=>{a.scene&&Object.assign(a,En(a.scene)),p(a)},t,a=>v(new Error(`Could not load ${l}: ${a==null?void 0:a.message}`)))))).finally(()=>s.dispose==null?void 0:s.dispose())}}function me(e,t,n,i){const s=Array.isArray(t)?t:[t],l=vn(Mt(n,i),[e,...s],{equal:I.equ});return Array.isArray(t)?l:l[0]}me.preload=function(e,t,n){const i=Array.isArray(t)?t:[t];return hn(Mt(n),[e,...i])};me.clear=function(e,t){const n=Array.isArray(t)?t:[t];return gn([e,...n])};const le=new Map,{invalidate:ot,advance:it}=Dn(le),{reconciler:Pe,applyProps:ne}=bn(le,xn),re={objects:"shallow",strict:!1},Ln=(e,t)=>{const n=typeof e=="function"?e(t):e;return wt(n)?n:new qt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Fn(e,t){const n=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:s,top:l,left:p,updateStyle:v=n}=t;return{width:i,height:s,top:l,left:p,updateStyle:v}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:s,top:l,left:p}=e.parentElement.getBoundingClientRect();return{width:i,height:s,top:l,left:p,updateStyle:n}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:n};return{width:0,height:0,top:0,left:0}}function zn(e){const t=le.get(e),n=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,l=i||jn(ot,it),p=n||Pe.createContainer(l,se.ConcurrentRoot,null,!1,null,"",s,null);t||le.set(e,{fiber:p,store:l});let v,a=!1,g;return{configure(r={}){let{gl:o,size:u,scene:d,events:m,onCreated:P,shadows:w=!1,linear:c=!1,flat:f=!1,legacy:b=!1,orthographic:C=!1,frameloop:x="always",dpr:M=[1,2],performance:T,raycaster:D,camera:j,onPointerMissed:L}=r,_=l.getState(),A=_.gl;_.gl||_.set({gl:A=Ln(o,e)});let $=_.raycaster;$||_.set({raycaster:$=new Nt});const{params:q,...W}=D||{};if(I.equ(W,$,re)||ne($,{...W}),I.equ(q,$.params,re)||ne($,{params:{...$.params,...q}}),!_.camera||_.camera===g&&!I.equ(g,j,re)){g=j;const R=j instanceof Vt,k=R?j:C?new Be(0,0,0,0,.1,1e3):new $e(75,0,.1,1e3);R||(k.position.z=5,j&&ne(k,j),!_.camera&&!(j!=null&&j.rotation)&&k.lookAt(0,0,0)),_.set({camera:k}),$.camera=k}if(!_.scene){let R;d instanceof Ye?R=d:(R=new Ye,d&&ne(R,d)),_.set({scene:oe(R)})}if(!_.xr){var N;const R=(F,G)=>{const X=l.getState();X.frameloop!=="never"&&it(F,!0,X,G)},k=()=>{const F=l.getState();F.gl.xr.enabled=F.gl.xr.isPresenting,F.gl.xr.setAnimationLoop(F.gl.xr.isPresenting?R:null),F.gl.xr.isPresenting||ot(F)},H={connect(){const F=l.getState().gl;F.xr.addEventListener("sessionstart",k),F.xr.addEventListener("sessionend",k)},disconnect(){const F=l.getState().gl;F.xr.removeEventListener("sessionstart",k),F.xr.removeEventListener("sessionend",k)}};typeof((N=A.xr)==null?void 0:N.addEventListener)=="function"&&H.connect(),_.set({xr:H})}if(A.shadowMap){const R=A.shadowMap.enabled,k=A.shadowMap.type;if(A.shadowMap.enabled=!!w,I.boo(w))A.shadowMap.type=Ce;else if(I.str(w)){var B;const H={basic:Xt,percentage:Yt,soft:Ce,variance:Zt};A.shadowMap.type=(B=H[w])!=null?B:Ce}else I.obj(w)&&Object.assign(A.shadowMap,w);(R!==A.shadowMap.enabled||k!==A.shadowMap.type)&&(A.shadowMap.needsUpdate=!0)}const y=dt();y&&("enabled"in y?y.enabled=!b:"legacyMode"in y&&(y.legacyMode=b)),ne(A,{outputEncoding:c?3e3:3001,toneMapping:f?Ut:Gt}),_.legacy!==b&&_.set(()=>({legacy:b})),_.linear!==c&&_.set(()=>({linear:c})),_.flat!==f&&_.set(()=>({flat:f})),o&&!I.fun(o)&&!wt(o)&&!I.equ(o,A,re)&&ne(A,o),m&&!_.events.handlers&&_.set({events:m(l)});const O=Fn(e,u);return I.equ(O,_.size,re)||_.setSize(O.width,O.height,O.updateStyle,O.top,O.left),M&&_.viewport.dpr!==gt(M)&&_.setDpr(M),_.frameloop!==x&&_.setFrameloop(x),_.onPointerMissed||_.set({onPointerMissed:L}),T&&!I.equ(T,_.performance,re)&&_.set(R=>({performance:{...R.performance,...T}})),v=P,a=!0,this},render(r){return a||this.configure(),Pe.updateContainer(h.createElement(In,{store:l,children:r,onCreated:v,rootElement:e}),p,null,()=>{}),l},unmount(){St(e)}}}function In({store:e,children:t,onCreated:n,rootElement:i}){return pe(()=>{const s=e.getState();s.set(l=>({internal:{...l.internal,active:!0}})),n&&n(s),e.getState().events.connected||s.events.connect==null||s.events.connect(i)},[]),h.createElement(_t.Provider,{value:e},t)}function St(e,t){const n=le.get(e),i=n==null?void 0:n.fiber;if(i){const s=n==null?void 0:n.store.getState();s&&(s.internal.active=!1),Pe.updateContainer(null,i,null,()=>{s&&setTimeout(()=>{try{var l,p,v,a;s.events.disconnect==null||s.events.disconnect(),(l=s.gl)==null||(p=l.renderLists)==null||p.dispose==null||p.dispose(),(v=s.gl)==null||v.forceContextLoss==null||v.forceContextLoss(),(a=s.gl)!=null&&a.xr&&s.xr.disconnect(),Mn(s),le.delete(e),t&&t(e)}catch{}},500)})}}Pe.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:h.version});const Le={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Wn(e){const{handlePointer:t}=On(e);return{priority:1,enabled:!0,compute(n,i,s){i.pointer.set(n.offsetX/i.size.width*2-1,-(n.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Le).reduce((n,i)=>({...n,[i]:t(i)}),{}),update:()=>{var n;const{events:i,internal:s}=e.getState();(n=s.lastEvent)!=null&&n.current&&i.handlers&&i.handlers.onPointerMove(s.lastEvent.current)},connect:n=>{var i;const{set:s,events:l}=e.getState();l.disconnect==null||l.disconnect(),s(p=>({events:{...p.events,connected:n}})),Object.entries((i=l.handlers)!=null?i:[]).forEach(([p,v])=>{const[a,g]=Le[p];n.addEventListener(a,v,{passive:g})})},disconnect:()=>{const{set:n,events:i}=e.getState();if(i.connected){var s;Object.entries((s=i.handlers)!=null?s:[]).forEach(([l,p])=>{if(i&&i.connected instanceof HTMLElement){const[v]=Le[l];i.connected.removeEventListener(v,p)}}),n(l=>({events:{...l.events,connected:void 0}}))}}}}const Bn=h.forwardRef(function({children:t,fallback:n,resize:i,style:s,gl:l,events:p=Wn,eventSource:v,eventPrefix:a,shadows:g,linear:r,flat:o,legacy:u,orthographic:d,frameloop:m,dpr:P,performance:w,raycaster:c,camera:f,scene:b,onPointerMissed:C,onCreated:x,...M},T){h.useMemo(()=>yn(Qt),[]);const D=un(),[j,L]=ln({scroll:!0,debounce:{scroll:50,resize:0},...i}),_=h.useRef(null),A=h.useRef(null);h.useImperativeHandle(T,()=>_.current);const $=mt(C),[q,W]=h.useState(!1),[N,B]=h.useState(!1);if(q)throw q;if(N)throw N;const y=h.useRef(null);pe(()=>{const E=_.current;L.width>0&&L.height>0&&E&&(y.current||(y.current=zn(E)),y.current.configure({gl:l,events:p,shadows:g,linear:r,flat:o,legacy:u,orthographic:d,frameloop:m,dpr:P,performance:w,raycaster:c,camera:f,scene:b,size:L,onPointerMissed:(...O)=>$.current==null?void 0:$.current(...O),onCreated:O=>{O.events.connect==null||O.events.connect(v?wn(v)?v.current:v:A.current),a&&O.setEvents({compute:(R,k)=>{const H=R[a+"X"],F=R[a+"Y"];k.pointer.set(H/k.size.width*2-1,-(F/k.size.height)*2+1),k.raycaster.setFromCamera(k.pointer,k.camera)}}),x==null||x(O)}}),y.current.render(h.createElement(D,null,h.createElement(vt,{set:B},h.createElement(h.Suspense,{fallback:h.createElement(_n,{set:W})},t)))))}),h.useEffect(()=>{const E=_.current;if(E)return()=>St(E)},[]);const S=v?"none":"auto";return h.createElement("div",Z({ref:A,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:S,...s}},M),h.createElement("div",{ref:j,style:{width:"100%",height:"100%"}},h.createElement("canvas",{ref:_,style:{display:"block"}},n)))}),br=h.forwardRef(function(t,n){return h.createElement(cn,null,h.createElement(Bn,Z({},t,{ref:n})))}),ve=new V,Ue=new V,$n=new V;function Hn(e,t,n){const i=ve.setFromMatrixPosition(e.matrixWorld);i.project(t);const s=n.width/2,l=n.height/2;return[i.x*s+s,-(i.y*l)+l]}function Nn(e,t){const n=ve.setFromMatrixPosition(e.matrixWorld),i=Ue.setFromMatrixPosition(t.matrixWorld),s=n.sub(i),l=t.getWorldDirection($n);return s.angleTo(l)>Math.PI/2}function Un(e,t,n,i){const s=ve.setFromMatrixPosition(e.matrixWorld),l=s.clone();l.project(t),n.setFromCamera(l,t);const p=n.intersectObjects(i,!0);if(p.length){const v=p[0].distance;return s.distanceTo(n.ray.origin)<v}return!0}function Gn(e,t){if(t instanceof Be)return t.zoom;if(t instanceof $e){const n=ve.setFromMatrixPosition(e.matrixWorld),i=Ue.setFromMatrixPosition(t.matrixWorld),s=t.fov*Math.PI/180,l=n.distanceTo(i);return 1/(2*Math.tan(s/2)*l)}else return 1}function qn(e,t,n){if(t instanceof $e||t instanceof Be){const i=ve.setFromMatrixPosition(e.matrixWorld),s=Ue.setFromMatrixPosition(t.matrixWorld),l=i.distanceTo(s),p=(n[1]-n[0])/(t.far-t.near),v=n[1]-p*t.far;return Math.round(p*l+v)}}const We=e=>Math.abs(e)<1e-10?0:e;function Ct(e,t,n=""){let i="matrix3d(";for(let s=0;s!==16;s++)i+=We(t[s]*e.elements[s])+(s!==15?",":")");return n+i}const Vn=(e=>t=>Ct(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Xn=(e=>(t,n)=>Ct(t,e(n),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Yn(e){return e&&typeof e=="object"&&"current"in e}const wr=h.forwardRef(({children:e,eps:t=.001,style:n,className:i,prepend:s,center:l,fullscreen:p,portal:v,distanceFactor:a,sprite:g=!1,transform:r=!1,occlude:o,onOcclude:u,castShadow:d,receiveShadow:m,material:P,geometry:w,zIndexRange:c=[16777271,0],calculatePosition:f=Hn,as:b="div",wrapperClass:C,pointerEvents:x="auto",...M},T)=>{const{gl:D,camera:j,scene:L,size:_,raycaster:A,events:$,viewport:q}=_e(),[W]=h.useState(()=>document.createElement(b)),N=h.useRef(),B=h.useRef(null),y=h.useRef(0),S=h.useRef([0,0]),E=h.useRef(null),O=h.useRef(null),R=(v==null?void 0:v.current)||$.connected||D.domElement.parentNode,k=h.useRef(null),H=h.useRef(!1),F=h.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&Yn(o[0]),[o]);h.useLayoutEffect(()=>{const U=D.domElement;o&&o==="blending"?(U.style.zIndex=`${Math.floor(c[0]/2)}`,U.style.position="absolute",U.style.pointerEvents="none"):(U.style.zIndex=null,U.style.position=null,U.style.pointerEvents=null)},[o]),h.useLayoutEffect(()=>{if(B.current){const U=N.current=dn(W);if(L.updateMatrixWorld(),r)W.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const z=f(B.current,j,_);W.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${z[0]}px,${z[1]}px,0);transform-origin:0 0;`}return R&&(s?R.prepend(W):R.appendChild(W)),()=>{R&&R.removeChild(W),U.unmount()}}},[R,r]),h.useLayoutEffect(()=>{C&&(W.className=C)},[C]);const G=h.useMemo(()=>r?{position:"absolute",top:0,left:0,width:_.width,height:_.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:l?"translate3d(-50%,-50%,0)":"none",...p&&{top:-_.height/2,left:-_.width/2,width:_.width,height:_.height},...n},[n,l,p,_,r]),X=h.useMemo(()=>({position:"absolute",pointerEvents:x}),[x]);h.useLayoutEffect(()=>{if(H.current=!1,r){var U;(U=N.current)==null||U.render(h.createElement("div",{ref:E,style:G},h.createElement("div",{ref:O,style:X},h.createElement("div",{ref:T,className:i,style:n,children:e}))))}else{var z;(z=N.current)==null||z.render(h.createElement("div",{ref:T,style:G,className:i,children:e}))}});const te=h.useRef(!0);Ee(U=>{if(B.current){j.updateMatrixWorld(),B.current.updateWorldMatrix(!0,!1);const z=r?S.current:f(B.current,j,_);if(r||Math.abs(y.current-j.zoom)>t||Math.abs(S.current[0]-z[0])>t||Math.abs(S.current[1]-z[1])>t){const K=Nn(B.current,j);let Y=!1;F&&(Array.isArray(o)?Y=o.map(J=>J.current):o!=="blending"&&(Y=[L]));const ce=te.current;if(Y){const J=Un(B.current,j,A,Y);te.current=J&&!K}else te.current=!K;ce!==te.current&&(u?u(!te.current):W.style.display=te.current?"block":"none");const he=Math.floor(c[0]/2),jt=o?F?[c[0],he]:[he-1,0]:c;if(W.style.zIndex=`${qn(B.current,j,jt)}`,r){const[J,Ve]=[_.width/2,_.height/2],Me=j.projectionMatrix.elements[5]*Ve,{isOrthographicCamera:Xe,top:kt,left:Tt,bottom:At,right:Dt}=j,Lt=Vn(j.matrixWorldInverse),Ft=Xe?`scale(${Me})translate(${We(-(Dt+Tt)/2)}px,${We((kt+At)/2)}px)`:`translateZ(${Me}px)`;let Q=B.current.matrixWorld;g&&(Q=j.matrixWorldInverse.clone().transpose().copyPosition(Q).scale(B.current.scale),Q.elements[3]=Q.elements[7]=Q.elements[11]=0,Q.elements[15]=1),W.style.width=_.width+"px",W.style.height=_.height+"px",W.style.perspective=Xe?"":`${Me}px`,E.current&&O.current&&(E.current.style.transform=`${Ft}${Lt}translate(${J}px,${Ve}px)`,O.current.style.transform=Xn(Q,1/((a||10)/400)))}else{const J=a===void 0?1:Gn(B.current,j)*a;W.style.transform=`translate3d(${z[0]}px,${z[1]}px,0) scale(${J})`}S.current=z,y.current=j.zoom}}if(!F&&k.current&&!H.current)if(r){if(E.current){const z=E.current.children[0];if(z!=null&&z.clientWidth&&z!=null&&z.clientHeight){const{isOrthographicCamera:K}=j;if(K||w)M.scale&&(Array.isArray(M.scale)?M.scale instanceof V?k.current.scale.copy(M.scale.clone().divideScalar(1)):k.current.scale.set(1/M.scale[0],1/M.scale[1],1/M.scale[2]):k.current.scale.setScalar(1/M.scale));else{const Y=(a||10)/400,ce=z.clientWidth*Y,he=z.clientHeight*Y;k.current.scale.set(ce,he,1)}H.current=!0}}}else{const z=W.children[0];if(z!=null&&z.clientWidth&&z!=null&&z.clientHeight){const K=1/q.factor,Y=z.clientWidth*K,ce=z.clientHeight*K;k.current.scale.set(Y,ce,1),H.current=!0}k.current.lookAt(U.camera.position)}});const qe=h.useMemo(()=>({vertexShader:r?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[r]);return h.createElement("group",Z({},M,{ref:B}),o&&!F&&h.createElement("mesh",{castShadow:d,receiveShadow:m,ref:k},w||h.createElement("planeGeometry",null),P||h.createElement("shaderMaterial",{side:en,vertexShader:qe.vertexShader,fragmentShader:qe.fragmentShader})))}),Zn=()=>parseInt(tn.replace(/\D+/g,"")),xt=Zn();let be=null,Rt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Ot(e,t,n){return i=>{n&&n(i),e&&(be||(be=new pn),be.setDecoderPath(typeof e=="string"?e:Rt),i.setDRACOLoader(be)),t&&i.setMeshoptDecoder(typeof xe=="function"?xe():xe)}}function Ge(e,t=!0,n=!0,i){return me(He,e,Ot(t,n,i))}Ge.preload=(e,t=!0,n=!0,i)=>me.preload(He,e,Ot(t,n,i));Ge.clear=e=>me.clear(He,e);Ge.setDecoderPath=e=>{Rt=e};function _r(e,t){const n=h.useRef(),[i]=h.useState(()=>t?t instanceof Ze?{current:t}:t:n),[s]=h.useState(()=>new nn(void 0));h.useLayoutEffect(()=>{t&&(i.current=t instanceof Ze?t:t.current),s._root=i.current});const l=h.useRef({}),p=h.useMemo(()=>{const v={};return e.forEach(a=>Object.defineProperty(v,a.name,{enumerable:!0,get(){if(i.current)return l.current[a.name]||(l.current[a.name]=s.clipAction(a,i.current))},configurable:!0})),{ref:i,clips:e,actions:v,names:e.map(a=>a.name),mixer:s}},[e]);return Ee((v,a)=>s.update(a)),h.useEffect(()=>{const v=i.current;return()=>{l.current={},s.stopAllAction(),Object.values(p.actions).forEach(a=>{v&&s.uncacheAction(a,v)})}},[e]),p}const Fe=xt>=154?"opaque_fragment":"output_fragment";class Kn extends rn{constructor(t){super(t),this.onBeforeCompile=(n,i)=>{const{isWebGL2:s}=i.capabilities;n.fragmentShader=n.fragmentShader.replace(`#include <${Fe}>`,`
        ${s?`#include <${Fe}>`:`#extension GL_OES_standard_derivatives : enable
#include <${Fe}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${xt>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const Pr=h.forwardRef((e,t)=>{const[n]=h.useState(()=>new Kn(null));return h.createElement("primitive",Z({},e,{object:n,ref:t,attach:"material"}))});let ee,de;const Jn=h.createContext(null),st=new on,at=new V,Qn=h.forwardRef(({children:e,range:t,limit:n=1e3,...i},s)=>{const l=h.useRef(null),[p,v]=h.useState([]),[[a,g,r]]=h.useState(()=>[new Float32Array(n*3),Float32Array.from({length:n*3},()=>1),Float32Array.from({length:n},()=>1)]);h.useEffect(()=>{l.current.geometry.attributes.position.needsUpdate=!0}),Ee(()=>{for(l.current.updateMatrix(),l.current.updateMatrixWorld(),st.copy(l.current.matrixWorld).invert(),l.current.geometry.drawRange.count=Math.min(n,t!==void 0?t:n,p.length),ee=0;ee<p.length;ee++)de=p[ee].current,de.getWorldPosition(at).applyMatrix4(st),at.toArray(a,ee*3),l.current.geometry.attributes.position.needsUpdate=!0,de.matrixWorldNeedsUpdate=!0,de.color.toArray(g,ee*3),l.current.geometry.attributes.color.needsUpdate=!0,r.set([de.size],ee),l.current.geometry.attributes.size.needsUpdate=!0});const o=h.useMemo(()=>({getParent:()=>l,subscribe:u=>(v(d=>[...d,u]),()=>v(d=>d.filter(m=>m.current!==u.current)))}),[]);return h.createElement("points",Z({userData:{instances:p},matrixAutoUpdate:!1,ref:ct([s,l]),raycast:()=>null},i),h.createElement("bufferGeometry",null,h.createElement("bufferAttribute",{attach:"attributes-position",count:a.length/3,array:a,itemSize:3,usage:ae}),h.createElement("bufferAttribute",{attach:"attributes-color",count:g.length/3,array:g,itemSize:3,usage:ae}),h.createElement("bufferAttribute",{attach:"attributes-size",count:r.length,array:r,itemSize:1,usage:ae})),h.createElement(Jn.Provider,{value:o},e))}),er=h.forwardRef(({children:e,positions:t,colors:n,sizes:i,stride:s=3,...l},p)=>{const v=h.useRef(null);return Ee(()=>{const a=v.current.geometry.attributes;a.position.needsUpdate=!0,n&&(a.color.needsUpdate=!0),i&&(a.size.needsUpdate=!0)}),h.createElement("points",Z({ref:ct([p,v])},l),h.createElement("bufferGeometry",null,h.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/s,array:t,itemSize:s,usage:ae}),n&&h.createElement("bufferAttribute",{attach:"attributes-color",count:n.length/s,array:n,itemSize:3,usage:ae}),i&&h.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/s,array:i,itemSize:1,usage:ae})),e)}),Er=h.forwardRef((e,t)=>e.positions instanceof Float32Array?h.createElement(er,Z({},e,{ref:t})):h.createElement(Qn,Z({},e,{ref:t})));function Mr({all:e,scene:t,camera:n}){const i=_e(({gl:p})=>p),s=_e(({camera:p})=>p),l=_e(({scene:p})=>p);return h.useLayoutEffect(()=>{const p=[];e&&(t||l).traverse(g=>{g.visible===!1&&(p.push(g),g.visible=!0)}),i.compile(t||l,n||s);const v=new sn(128);new an(.01,1e5,v).update(i,t||l),v.dispose(),p.forEach(g=>g.visible=!1)},[]),null}const tr="modulepreload",nr=function(e){return"/"+e},lt={},Sr=function(t,n,i){let s=Promise.resolve();if(n&&n.length>0){const l=document.getElementsByTagName("link");s=Promise.all(n.map(p=>{if(p=nr(p),p in lt)return;lt[p]=!0;const v=p.endsWith(".css"),a=v?'[rel="stylesheet"]':"";if(!!i)for(let o=l.length-1;o>=0;o--){const u=l[o];if(u.href===p&&(!v||u.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${a}`))return;const r=document.createElement("link");if(r.rel=v?"stylesheet":tr,v||(r.as="script",r.crossOrigin=""),r.href=p,document.head.appendChild(r),v)return new Promise((o,u)=>{r.addEventListener("load",o),r.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${p}`)))})}))}return s.then(()=>t()).catch(l=>{const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=l,window.dispatchEvent(p),!p.defaultPrevented)throw l})};export{br as C,wr as H,Mr as P,Sr as _,yr as a,ne as b,vr as c,gr as d,Er as e,Pr as f,hr as g,Ge as h,_r as i,_e as j,Ee as u};
